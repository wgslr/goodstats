(this.webpackJsonpgoodstats=this.webpackJsonpgoodstats||[]).push([[0],{14:function(t,e,a){},16:function(t,e,a){t.exports=a.p+"static/media/logo.5d5d9eef.svg"},17:function(t,e,a){},18:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),o=a(7),s=a.n(o),c=(a(14),a(1)),i=a.n(c),u=a(3),l=a(2),d=a(8),m=a(4),h=a(5);function p(t,e){return Math.round((e-t)/864e5)}var f=function(){function t(){Object(m.a)(this,t),this.bottom=0,this.books=[]}return Object(h.a)(t,[{key:"addBook",value:function(t){this.books.push(t),this.bottom=t.startedAgo}}]),t}();var g=function(t){var e=t.books,a=function(t){var e=[new f],a=[],n=99999;return t.sort((function(t,e){return t.readAgo<e.readAgo?-1:t.readAgo>e.readAgo?1:t.startedAgo<e.startedAgo?-1:t.startedAgo>e.startedAgo?1:0})),t.forEach((function(t){var r=e.find((function(e){return e.bottom<=t.readAgo}));r||(r=new f,e.push(r)),r.addBook(t),a.includes(t.readAgo)||a.push(t.readAgo),a.includes(t.startedAgo)||a.push(t.startedAgo),n=Math.min(t.readAgo,n)})),a.sort((function(t,e){return t-e})),{columns:e,latestDay:n,datePoints:a}}(e=function(t){var e=new Date;return t.map((function(t){return Object(d.a)({},t,{duration:t.days,readAgo:p(t.readAt,e),startedAgo:p(t.startedAt,e)})}))}(e)),n=a.columns,o=a.latestDay,s=a.datePoints;return console.log({columns:n,latestDay:o}),r.a.createElement("div",{className:"timeline"},r.a.createElement("div",{className:"timeAxis"},s.map((function(t){return r.a.createElement("div",{style:{position:"absolute",top:"".concat(1.2*(t-o)).concat("em"),marginTop:"-0.5em",lineHeight:"1em"}},t," days ago")}))),n.map((function(t,e){return r.a.createElement("div",{className:"column",key:e.toString()},t.books.map((function(e,a){return r.a.createElement("div",{key:e.title,className:"book",style:{width:"100%",height:"".concat(1.2*e.days).concat("em"),maxHeight:"".concat(1.2*e.days).concat("em"),marginTop:0===a?"".concat(1.2*(e.readAgo-o)).concat("em"):"".concat(1.2*(e.readAgo-t.books[a-1].startedAgo)).concat("em")}},e.title)})))})))},v=(a(16),"goodstats.herokuapp.com"),b=function(){function t(e,a){Object(m.a)(this,t),this.code=e,this.codeText=a}return Object(h.a)(t,[{key:"toString",value:function(){return"Server returned ".concat(this.code," ").concat(this.codeText," response")}}]),t}();function E(t){return w.apply(this,arguments)}function w(){return(w=Object(l.a)(i.a.mark((function t(e){var a,n,r,o,s=arguments;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=s.length>1&&void 0!==s[1]?s[1]:30,t.next=3,O("/review/list",{id:e,per_page:a,sort:"date_read"});case 3:return n=t.sent,r=A(n),o=r.reviews,t.abrupt("return",o);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function k(t,e,a){return t.evaluate(a,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}function A(t){for(var e=k(t,t.documentElement,"reviews"),a=e.start,n=e.end,r=e.total,o=[],s=t.evaluate("//reviews/review",t.documentElement,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),c=0;c<s.snapshotLength;++c){for(var i=s.snapshotItem(c),u=[],l=t.evaluate("shelves/shelf",i,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),d=0;d<l.snapshotLength;++d)u.push(l.snapshotItem(d).attributes.name);k(t,i,"started_at").textContent;var m=k(t,i,"read_at").textContent,h=k(t,i,"started_at").textContent;m=m?y(m):null;var f=(h=h?y(h):m)&&m?p(h,m):null;o.push({shelves:u,startedAt:h,readAt:m,days:f,title:k(t,i,"book/title").textContent})}return{start:a,end:n,total:r,reviews:o}}function y(t){var e=t.split(" "),a=Object(u.a)(e,6),n=a[1],r=a[2],o=a[5];return new Date(o,{Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[n],r)}function O(t,e){return x.apply(this,arguments)}function x(){return(x=Object(l.a)(i.a.mark((function t(e,a){var n,r,o,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new URL("https://".concat(v,"/goodreads").concat(e))).search=new URLSearchParams(a).toString(),t.next=4,window.fetch(n,{mehod:"GET"});case 4:if((r=t.sent).ok){t.next=7;break}throw new b(r.status,r.statusText);case 7:return t.next=9,r.text();case 9:return o=t.sent,s=(new DOMParser).parseFromString(o,"application/xml"),t.abrupt("return",s);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}a(17);var D="loading",S="loaded",T="error";function j(){return(j=Object(l.a)(i.a.mark((function t(e,a){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,E(e,100);case 3:n=t.sent,console.log("books",n),a({status:S,details:{books:_(n),loadTimestamp:new Date}}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),a({status:T,details:{error:t.t0}});case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))).apply(this,arguments)}function _(t){return t.filter((function(t){return t.startedAt instanceof Date&&t.readAt instanceof Date}))}function N(){var t=Object(n.useState)({status:D,details:{}}),e=Object(u.a)(t,2),a=e[0],o=a.status,s=a.details,c=e[1],i=Object(n.useState)("29690543"),l=Object(u.a)(i,2),d=l[0],m=l[1];Object(n.useEffect)((function(){c({status:D,details:{}}),function(t,e){j.apply(this,arguments)}(d,c)}),[d]);var h="";switch(o){case D:h="Loading your books...";break;case S:var p=s.books,f=s.loadTimestamp;h=r.a.createElement("div",null,r.a.createElement("ul",null,p.slice(0,5).map((function(t){var e=t.title,a=t.days,n=t.startedAt,o=t.readAt;return r.a.createElement("li",{key:e},e," (read in ",a," days - from ",n.toLocaleDateString()," to ",o.toLocaleDateString(),")")})),p.length>5&&r.a.createElement("li",null,"... and more")),"Loaded at: ",f.toString(),r.a.createElement(g,{books:p}));break;case T:h="Loading books failed: "+s.error}return r.a.createElement("div",null,r.a.createElement("label",null,"User ID",r.a.createElement("input",{type:"text",value:d,onChange:function(t){return m(t.target.value)}})),r.a.createElement("h1",null,"Books you have read"),h)}var P=function(){return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Goodstats"),r.a.createElement("p",null,"This website uses your data from ",r.a.createElement("a",{href:"https//goodreads.com"},"Goodreads")," to display a history of reading. No data is persisted on our servers."),r.a.createElement(N,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(P,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))},9:function(t,e,a){t.exports=a(18)}},[[9,1,2]]]);
//# sourceMappingURL=main.3a25111d.chunk.js.map